# 部署前检查清单

## 服务器环境检查

### 1. 系统要求
- [ ] 操作系统: Ubuntu 20.04+ / CentOS 7+ / Debian 10+
- [ ] CPU: 2核心以上
- [ ] 内存: 2GB 以上
- [ ] 磁盘: 10GB 以上可用空间
- [ ] 网络: 公网 IP 或域名

### 2. 软件安装
- [ ] Docker 20.10+ 已安装
- [ ] Docker Compose 2.0+ 已安装
- [ ] Docker 服务正在运行
- [ ] 当前用户有 Docker 权限

### 3. 端口检查
- [ ] 端口 80 未被占用（HTTP）
- [ ] 端口 443 未被占用（HTTPS）
- [ ] 端口 3000 未被占用（前端，可选）
- [ ] 端口 8000 未被占用（后端，可选）

### 4. 网络检查
- [ ] 服务器可以访问互联网
- [ ] Docker Hub 可访问（或已配置镜像加速）
- [ ] 域名已解析到服务器 IP（如使用域名）

---

## 项目文件检查

### 1. 必要文件
- [ ] docker-compose.yml
- [ ] backend/Dockerfile
- [ ] backend/requirements.txt
- [ ] backend/app/main.py
- [ ] frontend/Dockerfile
- [ ] frontend/package.json
- [ ] README.md
- [ ] DEPLOYMENT.md

### 2. 配置文件
- [ ] .env 文件已创建（或使用默认配置）
- [ ] CORS_ORIGINS 已配置为实际域名
- [ ] SECRET_KEY 已修改（生产环境）

### 3. 目录权限
- [ ] 项目目录有读写权限
- [ ] data 目录已创建
- [ ] logs 目录已创建

---

## 企业微信配置准备

### 1. 企业微信应用
- [ ] 已创建企业微信自建应用
- [ ] 已获取 CorpID
- [ ] 已获取 AgentId
- [ ] 已获取 Secret

### 2. 回调配置
- [ ] 已生成 Token
- [ ] 已生成 EncodingAESKey
- [ ] 回调 URL 已准备（https://your-domain.com/api/v1/wechat/callback）

### 3. 应用权限
- [ ] 应用可见范围已设置
- [ ] 应用权限已配置（发送消息、接收消息）

---

## 安全配置检查

### 1. SSL 证书
- [ ] SSL 证书已准备（Let's Encrypt 或其他）
- [ ] 证书文件路径正确
- [ ] 证书有效期充足

### 2. 防火墙
- [ ] 已开放 HTTP 端口（80）
- [ ] 已开放 HTTPS 端口（443）
- [ ] 已限制不必要的端口

### 3. SSH 安全
- [ ] 已使用密钥认证
- [ ] 已禁用 root 登录（可选）
- [ ] 已修改默认 SSH 端口（可选）

---

## 部署步骤检查

### 1. 代码上传
- [ ] 代码已上传到服务器
- [ ] 文件权限正确
- [ ] 目录结构完整

### 2. 环境配置
- [ ] .env 文件已配置
- [ ] docker-compose.prod.yml 已创建（可选）
- [ ] 域名已替换为实际域名

### 3. Docker 构建
- [ ] 后端镜像构建成功
- [ ] 前端镜像构建成功
- [ ] 无构建错误

### 4. 服务启动
- [ ] 后端容器启动成功
- [ ] 前端容器启动成功
- [ ] 健康检查通过

### 5. Nginx 配置
- [ ] Nginx 已安装
- [ ] 反向代理配置已创建
- [ ] Nginx 配置测试通过
- [ ] Nginx 已重载

---

## 功能测试检查

### 1. 基础访问
- [ ] 可以访问前端界面（https://your-domain.com）
- [ ] 可以访问 API 文档（https://your-domain.com/docs）
- [ ] 健康检查正常（https://your-domain.com/health）

### 2. 企业微信配置
- [ ] 可以打开配置页面
- [ ] 可以保存配置
- [ ] 配置测试通过

### 3. 消息功能
- [ ] 可以发送测试消息
- [ ] 企业微信可以接收消息
- [ ] 可以接收企业微信消息
- [ ] 消息历史正常显示

### 4. 命令功能
- [ ] 命令列表正常显示
- [ ] 可以启用/禁用命令
- [ ] 菜单同步成功
- [ ] 企业微信菜单正常显示

---

## 监控和日志检查

### 1. 日志配置
- [ ] Docker 日志正常输出
- [ ] Nginx 日志正常记录
- [ ] 日志轮转已配置

### 2. 监控配置
- [ ] 容器健康检查正常
- [ ] 可以查看容器状态
- [ ] 可以查看资源使用情况

### 3. 备份配置
- [ ] 数据库备份脚本已创建
- [ ] 定时备份已配置（可选）
- [ ] 备份目录已创建

---

## 故障排查准备

### 1. 常见问题
- [ ] 已阅读 DEPLOYMENT.md 故障排查章节
- [ ] 知道如何查看日志
- [ ] 知道如何重启服务

### 2. 联系方式
- [ ] 已记录技术支持联系方式
- [ ] 已记录企业微信管理员联系方式

---

## 部署完成确认

### 1. 功能验证
- [ ] 所有核心功能正常工作
- [ ] 企业微信集成正常
- [ ] 无明显错误或警告

### 2. 性能验证
- [ ] 响应时间正常
- [ ] 资源使用合理
- [ ] 无内存泄漏

### 3. 文档更新
- [ ] 部署信息已记录
- [ ] 配置信息已备份
- [ ] 运维文档已更新

---

## 快速检查命令

```bash
# 运行自动检查脚本
chmod +x check-deployment.sh
./check-deployment.sh

# 手动检查关键项
docker --version
docker compose version
docker ps
curl http://localhost:8000/health
curl https://your-domain.com/health
```

---

## 部署成功标志

当以下所有项都完成时，部署即为成功：

✅ 服务器环境准备就绪
✅ 项目文件完整无误
✅ Docker 容器正常运行
✅ Nginx 反向代理配置正确
✅ SSL 证书配置成功
✅ 企业微信配置完成
✅ 所有功能测试通过
✅ 监控和日志正常
✅ 备份策略已实施

---

**注意**: 请按照此清单逐项检查，确保每一项都已完成后再进行下一步。
